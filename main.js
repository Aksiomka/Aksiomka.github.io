"use strict";const{assign}=Object;var isUndefined=a=>a==void 0;function ImageViewer(openImageTitle,imageGroups){let img=document.createElement('img');let fullSizeLink=document.createElement('a');fullSizeLink.target='_blank';fullSizeLink.appendChild(document.createTextNode(''));let extLink=document.createElement('p');extLink.className=imageGroups?'ext-link img-ext-link':'ext-link';let prevButton;let nextButton;let wrapper;imageGroups?(wrapper=document.createElement('div'),wrapper.className='image-wrapper',wrapper.appendChild(img),prevButton=addButton(extLink,'img-left','❮'),extLink.appendChild(fullSizeLink),nextButton=addButton(extLink,'img-right','❯')):(wrapper=img,extLink.appendChild(fullSizeLink));wrapper.className='image-viewer';let curtain=document.createElement('div');curtain.className='curtain';curtain.appendChild(wrapper);curtain.appendChild(extLink);let loader=document.createElement('div');loader.className='loader';function init(el){let size=el.dataset.size;let pixels=el.dataset.pixels;let title=openImageTitle;(size&&pixels)&&(title=title+' ('+pixels+', '+size+')');this.fullSizeLink.title=title;let group=el.dataset.group;if(!isUndefined(group)){prevButton.style=nextButton.style='';let groupIdx=parseInt(group);this.imageGroup=imageGroups[groupIdx];this.setImageIdx(parseInt(el.dataset.idx))}else{fullSizeLink.href=el.href;img.src=middleImage(el.href);let baseImg=el.querySelector('img');this.setTitle(baseImg.title||baseImg.alt||openImageTitle)}this.firstTime=!0;extLink.style='visibility: hidden;';curtain.classList.remove('active');document.body.appendChild(curtain)}function middleImage(ref){let dirIdx=ref.lastIndexOf('/');let dotIdx=ref.lastIndexOf('.');return ref.substring(0,dirIdx)+'/preview'+ref.substring(dirIdx,dotIdx)+'_middle'+ref.substring(dotIdx)}let imageViewer={wrapper:wrapper,fullSizeLink:fullSizeLink,init:init,setTitle:function(title){this.fullSizeLink.firstChild.textContent=title},firstTime:!0,imageGroup:[],imageIdx:0,setImageIdx:function(idx){this.imageIdx=idx;loader.style='';let imageItem=this.imageGroup[idx];this.setTitle(imageItem.title);img.alt=imageItem.alt;let href=imageItem.img;fullSizeLink.href=href;img.src=middleImage(href)},prevButton:prevButton,nextButton:nextButton,hasGroup:function(){return this.imageGroup.length>1}};curtain.addEventListener('click',e=>{curtain.remove()});document.addEventListener('keydown',e=>{if(e.key==='Escape')curtain.remove();else if(e.key==='ArrowLeft')imageViewer.hasGroup()&&prevImg();else if(e.key==='ArrowRight')imageViewer.hasGroup()&&nextImg()});fullSizeLink.addEventListener('click',e=>e.stopPropagation());img.addEventListener('click',e=>{e.stopPropagation();fullSizeLink.click()});function startAnimation(){curtain.classList.add('active');setTimeout(()=>{extLink.style='';imageGroups&&(prevButton.style='display: block;',nextButton.style='display: block;')},400)}img.addEventListener('load',()=>{loader.style='display: none;';imageViewer.firstTime&&(startAnimation(),imageViewer.firstTime=!1)});img.addEventListener('error',event=>{console.log('Image load error',event);curtain.remove()});imageGroups?(prevButton.addEventListener('click',event=>{event.stopPropagation();prevImg()}),nextButton.addEventListener('click',event=>{event.stopPropagation();nextImg()}),wrapper.appendChild(loader)):(curtain.appendChild(loader));function prevImg(){let idx=imageViewer.imageIdx;idx===0&&(idx=imageViewer.imageGroup.length);imageViewer.setImageIdx(idx-1)}function nextImg(){let idx=imageViewer.imageIdx;idx===imageViewer.imageGroup.length-1&&(idx=-1);imageViewer.setImageIdx(idx+1)}function addButton(el,clazz,text){var btn=document.createElement('button');btn.classList.add(clazz);btn.innerText=text;el.appendChild(btn);return btn}return imageViewer}function setupImageViewer(openImageTitle,imageGroups){let imageViewer=ImageViewer(openImageTitle,imageGroups);let clickEvent=e=>{e.preventDefault();imageViewer.init(e.target.closest('a.art-link'))};let images=document.getElementsByClassName('art-link');for(const el of images)el.addEventListener('click',clickEvent)}function storageChecker(itemName,handleTrue,handleFalse,defaultPreference){return{itemName:itemName,handleTrue:handleTrue,handleFalse:handleFalse,defaultPreference:defaultPreference,turnTrue:function(){this.handleTrue();this.store(!0)},turnFalse:function(){this.handleFalse();this.store(!1)},isTrue:function(){var value=window.localStorage.getItem(this.itemName);if(value===null)return this.defaultPreference();return value==='1'},store:function(value){var preffered=this.defaultPreference(),needToSave=(value===!0&&!preffered)||(value===!1&&preffered);if(needToSave){var newValue=value===!0?'1':'0';window.localStorage.setItem(this.itemName,newValue)}else{var oldValue=window.localStorage.getItem(this.itemName);oldValue!==null&&this.remove()}},remove:function(){window.localStorage.removeItem(this.itemName)},restore:function(){this.isTrue()?this.handleTrue():this.handleFalse()}}}function preferesEn(){return!navigator.language.startsWith('ru')}function redirectLang(eng){return ()=>{var path=window.location.pathname;window.location.replace(eng?path.replace('/ru/','/en/'):path.replace('/en/','/ru/'))}}function changeLanguage(){var path=window.location.pathname,eng=path.indexOf('/en/')!==-1,lang=storageChecker('lang',redirectLang(!0),redirectLang(!1),preferesEn);lang.store(!eng);lang.restore()}function renderPostTime(locale){let list=document.getElementsByClassName('post-time');let optDate={year:'numeric',month:'numeric',day:'numeric'};let optWithTime=assign({hour:'2-digit', minute:'2-digit'},optDate);for(let el of list){date=new Date(el.dateTime);el.innerHTML=el.dateTime.length===10||el.dateTime.indexOf('00:00')!==-1?date.toLocaleDateString(locale,optDate):date.toLocaleString(locale,optWithTime)}}function redirect(location){window.location.replace(location)}function metrika(){(function(m,e,t,r,i,k,a){m[i]=m[i]||function(...args){(m[i].a=m[i].a||[]).push(args)};m[i].l=1*new Date;for(var j=0;j<document.scripts.length;j++)if(document.scripts[j].src===r)return;k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window,document,'script','https://mc.yandex.ru/metrika/tag.js','ym');ym(100534172,'init',{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0})}